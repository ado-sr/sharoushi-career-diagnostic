# Googleスプレッドシート連携セットアップガイド

診断結果を自動でGoogleスプレッドシートに記録する設定手順です。

## 📊 完成イメージ

診断が完了するたびに、以下の情報が自動でスプレッドシートに追加されます：

| 診断日時 | ニックネーム | Xアカウント名 | 経験レベル | 診断タイプ | セグメント | RIASECコード | ... |
|---------|------------|-------------|-----------|-----------|-----------|------------|-----|
| 2025/12/18 14:30 | 田中太郎 | @tanaka_sr | 実務者（3年以上） | 💼 実務重視タイプ | 転職検討中 | SEC | ... |
| 2025/12/18 15:45 | 山田花子 | @yamada_sr | 受験生 | 🌱 成長志向タイプ | 受験生 | SIA | ... |

### セグメント自動判定

システムが以下のセグメントを自動判定します：

- **受験生**: 社労士試験の受験準備中
- **就職希望**: 合格後、就職を検討中
- **開業希望**: 独立開業を目指している
- **転職検討中**: 実務者で転職を検討
- **専門性追求**: 特定分野の専門性を深めたい
- **その他**: 上記以外

## 🚀 セットアップ手順（5分で完了）

### ステップ1: Googleスプレッドシートを作成

1. [Google スプレッドシート](https://sheets.google.com/)にアクセス
2. **空白のスプレッドシート**を新規作成
3. タイトルを「社労士キャリア診断 - データ収集」に変更

### ステップ2: Apps Scriptを開く

1. スプレッドシート上部のメニューから**「拡張機能」→「Apps Script」**をクリック
2. 新しいタブでApps Scriptエディタが開きます

### ステップ3: コードをコピー&ペースト

1. `google-apps-script/Code.gs` ファイルを開く
2. **すべてのコード**をコピー
3. Apps Scriptエディタの `Code.gs` に貼り付け（既存のコードは削除）
4. **保存アイコン（💾）**または `Ctrl + S` で保存

### ステップ4: ウェブアプリとして公開

1. Apps Scriptエディタ右上の**「デプロイ」→「新しいデプロイ」**をクリック
2. **「種類の選択」**で**「ウェブアプリ」**を選択
3. 以下を設定：
   - **説明**: 「社労士キャリア診断API」（任意）
   - **次のユーザーとして実行**: 「自分」
   - **アクセスできるユーザー**: **「全員」**（重要！）

4. **「デプロイ」**ボタンをクリック
5. **承認が必要**と表示されたら：
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「（プロジェクト名）に移動（安全ではないページ）」をクリック
   - 「許可」をクリック

6. デプロイ完了後、**ウェブアプリのURL**をコピー
   - 例: `https://script.google.com/macros/s/AKfycbxXXXXXXXXXXXXXX/exec`

### ステップ5: フロントエンドに設定

1. `index.html` を開く
2. 行1113付近の `GOOGLE_SHEETS_URL` を編集：

```javascript
// 変更前
const GOOGLE_SHEETS_URL = '';

// 変更後（コピーしたURLを貼り付け）
const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbxXXXXXXXXXXXXXX/exec';
```

3. ファイルを保存

### ステップ6: 動作確認

1. `index.html` をブラウザで開く
2. 診断を実施して完了まで進める
3. Googleスプレッドシートを確認

**成功の確認ポイント:**
- 1行目にヘッダー（診断日時、ニックネーム、など）が自動作成される
- 2行目以降に診断データが追加される
- セグメント列に自動判定結果が表示される

## 📈 データ集計機能

スプレッドシートにカスタムメニューが追加されます。

### 集計シートの作成

1. スプレッドシートを開く
2. メニューバーに**「📊 診断データ」**が表示される
3. **「集計シートを作成」**をクリック
4. 新しいシート「集計」が作成され、以下の集計が表示されます：
   - セグメント別集計（受験生、開業希望、など）
   - 診断タイプ別集計（成長志向、実務重視、など）
   - 経験レベル別集計

### 集計の更新

データが増えたら、再度「集計シートを作成」をクリックするだけで最新データに基づく集計が再作成されます。

## 📊 記録される情報一覧

| カラム名 | 説明 | 例 |
|---------|------|-----|
| 診断日時 | 診断完了日時 | 2025/12/18 14:30:25 |
| ニックネーム | ユーザーのニックネーム | 田中太郎 |
| Xアカウント名 | Xアカウント（@以降） | tanaka_sr |
| プロフィール画像URL | Xのプロフィール画像 | https://pbs.twimg.com/... |
| 経験レベル | 受験生/合格者/実務者/ベテラン | 実務者（3年以上） |
| 診断タイプ | 4つの診断結果 | 💼 実務重視タイプ |
| **セグメント** | **自動判定された分類** | **転職検討中** |
| RIASECコード | 3文字コード | SEC |
| R (現実的) | Realisticスコア | 6 |
| I (研究的) | Investigativeスコア | 8 |
| A (芸術的) | Artisticスコア | 4 |
| S (社会的) | Socialスコア | 12 |
| E (企業的) | Enterprisingスコア | 10 |
| C (慣習的) | Conventionalスコア | 9 |
| 信頼度 (%) | 診断の信頼度 | 85 |
| レア度 (%) | 希少性 | 15 |
| レアレベル | 激レア/レア/ふつう/よくいる | レア |
| キャリア・アンカー | Scheinの理論 | TF, GM |
| バッジ | 診断結果の称号 | 📚 ステディ・グロワー |
| 回答パス | 回答した質問の経路 | start → beginner_path → ... |
| User Agent | ブラウザ情報 | Mozilla/5.0... |
| リファラー | アクセス元URL | https://twitter.com/... |

## 🔍 データ分析の例

### 受験生の割合を知りたい

1. 「セグメント」列でフィルタ
2. 「受験生」を選択
3. 該当行の件数をカウント

### 開業希望者の特徴を分析

1. 「セグメント」列で「開業希望」をフィルタ
2. RIASEC各次元の平均値を算出
3. どの特性が高いか確認

### 流入元を確認

1. 「リファラー」列を確認
2. Twitter、Facebook、検索エンジンなど流入経路を分析

### 診断の時系列推移

1. 「診断日時」列でソート
2. 日別、週別、月別の診断数をグラフ化

## 🛠️ トラブルシューティング

### データが記録されない

**原因1: URLが設定されていない**
→ `index.html` の `GOOGLE_SHEETS_URL` を確認

**原因2: アクセス権限が「全員」になっていない**
→ Apps Scriptのデプロイ設定を確認

**原因3: ブラウザのコンソールにエラー表示**
→ F12キーを押して開発者ツールを開き、エラーメッセージを確認

### ヘッダーが重複する

初回実行時に自動でヘッダーが作成されます。手動でヘッダーを削除した場合は、もう一度診断を実行するとヘッダーが再作成されます。

### 「承認が必要」で進まない

Googleの警告画面で「詳細」→「（安全ではないページに）移動」をクリックする必要があります。これは自分で作成したスクリプトなので問題ありません。

## 📊 Looker Studio（旧 Google Data Studio）との連携

より高度な可視化を行いたい場合：

1. [Looker Studio](https://lookerstudio.google.com/) にアクセス
2. 「作成」→「データソース」
3. 「Google スプレッドシート」を選択
4. 作成したスプレッドシートを接続
5. ダッシュボードを作成して可視化

### おすすめグラフ

- **円グラフ**: セグメント別の割合
- **棒グラフ**: 診断タイプ別の人数
- **時系列グラフ**: 日別の診断数推移
- **散布図**: RIASEC次元の相関分析
- **ヒートマップ**: 時間帯別の診断数

## 🔐 プライバシーとセキュリティ

### 収集データの取り扱い

- Xアカウント情報は**ユーザーが任意で入力**したもののみ保存
- スプレッドシートは**あなたのGoogleアカウント**でのみアクセス可能
- データは**第三者と共有されません**

### GDPR / 個人情報保護法への対応

もし個人を特定できる情報（Xアカウント名など）を収集する場合：

1. 診断開始前にプライバシーポリシーへのリンクを表示
2. データ収集の目的を明示
3. ユーザーの同意を取得

`index.html` にプライバシー同意チェックボックスを追加することをおすすめします。

## 📞 サポート

問題が発生した場合は、社労士Lab開発チームまでお問い合わせください。

---

**制作**: 社労士Lab開発チーム
**最終更新**: 2025年12月18日
